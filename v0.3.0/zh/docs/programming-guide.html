


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>编程指南 &mdash; incubator-singa 0.3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="incubator-singa 0.3.0 documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> incubator-singa
          

          
            
            <img src="../_static/singa.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">SINGA 中文文档</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul class="simple">
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul class="simple">
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">incubator-singa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>编程指南</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="">
<span id="id1"></span><h1>编程指南<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>要提交一个训练作业，用户需要提供图1中的四个部分的配置：</p>
<ul class="simple">
<li><a class="reference external" href="neural-net.html">NeuralNet</a> ：描述神经网络结构，包括每层的具体设置和层与层的连接关系；</li>
<li><a class="reference external" href="train-one-batch.html">TrainOneBatch</a> ：该算法需要根据不同的模型类别而定制;</li>
<li><a class="reference external" href="updater.html">Updater</a> ：定义服务器端更新参数的协议；</li>
<li><a class="reference external" href="distributed-training.html">Cluster Topology</a> ：指定服务器和工作者的分布式拓扑架构。</li>
</ul>
<p><em>初级用户指南</em> 将介绍如何利用内建层提交一个训练作业，而 <em>高级用户指南</em> 将详细介绍如何编写用户自己的主函数并注册自己实现的组件。此外，高级用户和初级用户对训练数据集的<a class="reference external" href="data.html">处理</a>方式是相同的。</p>
<p><img src="../_static/images/overview.png" align="center" width="400px"/>
<span><strong>图 1 - SINGA 概览</strong></span></p>
<div class="section" id="">
<span id="id2"></span><h2>初级用户指南<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h2>
<p>用户可以使用SINGA提供的主函数提交训练作业。对于这种情况，用户必须在命令行中提供根据 <a class="reference external" href="../api/classsinga_1_1JobProto.html">JobProto</a> 设置的作业配置文件，</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">singa</span><span class="o">-</span><span class="n">run</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">conf</span> <span class="o">&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">job</span> <span class="n">conf</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">-</span><span class="n">resume</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">-resume</span></code> 表示从上次的<a class="reference external" href="checkpoint.html">检查点（checkpoint）</a>继续训练。
<a class="reference external" href="mlp.html">MLP</a> 模型和 <a class="reference external" href="cnn.html">CNN</a> 模型使用内建层提交训练作业。请阅读相关页面，查看它们的作业配置文件，这些页面会介绍每个组件配置的细节。</p>
</div>
<div class="section" id="">
<span id="id3"></span><h2>高级用户指南<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h2>
<p>如果用户的模型中包含一些自己定义的组件，比如<a class="reference external" href="updater.html">Updater</a>，用户必须自己编写主函数注册这些组件，跟Hadoop的主函数类似。一般地，主函数应该</p>
<ul class="simple">
<li>初始化SINGA，如：设置日志；</li>
<li>注册用户自定义组件；</li>
<li>创建作业配置并传递给SINGA driver。</li>
</ul>
<p>主函数示例</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#include &quot;singa.h&quot;</span>
<span class="c1">#include &quot;user.h&quot;  // header for user code</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">singa</span><span class="p">::</span><span class="n">Driver</span> <span class="n">driver</span><span class="p">;</span>
  <span class="n">driver</span><span class="o">.</span><span class="n">Init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="nb">bool</span> <span class="n">resume</span><span class="p">;</span>
  <span class="o">//</span> <span class="n">parse</span> <span class="n">resume</span> <span class="n">option</span> <span class="kn">from</span> <span class="nn">argv.</span>

  <span class="o">//</span> <span class="n">register</span> <span class="n">user</span> <span class="n">defined</span> <span class="n">layers</span>
  <span class="n">driver</span><span class="o">.</span><span class="n">RegisterLayer</span><span class="o">&lt;</span><span class="n">FooLayer</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kFooLayer</span><span class="p">);</span>
  <span class="o">//</span> <span class="n">register</span> <span class="n">user</span> <span class="n">defined</span> <span class="n">updater</span>
  <span class="n">driver</span><span class="o">.</span><span class="n">RegisterUpdater</span><span class="o">&lt;</span><span class="n">FooUpdater</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kFooUpdater</span><span class="p">);</span>
  <span class="o">...</span>
  <span class="n">auto</span> <span class="n">jobConf</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">job_conf</span><span class="p">();</span>
  <span class="o">//</span>  <span class="n">update</span> <span class="n">jobConf</span>

  <span class="n">driver</span><span class="o">.</span><span class="n">Train</span><span class="p">(</span><span class="n">resume</span><span class="p">,</span> <span class="n">jobConf</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>driver 类&#8217; <code class="docutils literal"><span class="pre">Init</span></code> 方法加载用户在命令行参数中 （<code class="docutils literal"><span class="pre">-conf</span> <span class="pre">&lt;job</span> <span class="pre">conf&gt;</span></code>）提供的作业配置文件（至少包含集群拓扑结构），并返回<code class="docutils literal"><span class="pre">jobConf</span></code>给用户，用户可更新和添加神经网络或者Updater的配置。如果定义了Layer、Updater、Worker或者Param的子类，用户需要通过driver为它们注册。最后，作业配置会被提交到driver，由driver启动训练。</p>
<p>将来我们会提供类似<a class="reference external" href="https://github.com/fchollet/keras">keras</a> 的帮助工具，使作业配置更加简单。</p>
<p>用户需要使用SINGA库(<em>.libs/libsinga.so</em>)编译和链接自己的代码（如：layer的实现和主函数），得到可执行文件，如名为<em>mysinga</em> 的文件。执行以下命令启动该程序，用户需要将<em>mysinga</em> 和作业配置文件的路径传给 <em>./bin/singa-run.sh</em> 。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">singa</span><span class="o">-</span><span class="n">run</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">conf</span> <span class="o">&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">job</span> <span class="n">conf</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">exec</span> <span class="o">&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">mysinga</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">other</span> <span class="n">arguments</span><span class="p">]</span>
</pre></div>
</div>
<p><a class="reference external" href="rnn.html">RNN application</a> 提供了一个完整的实现主函数训练特定RNN模型的例子。</p>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 The Apache Software Foundation. All rights reserved. Apache Singa, Apache, the Apache feather logo, and the Apache Singa project logos are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  


<div class="rst-versions shift-up" data-toggle="rst-versions" role="note" aria-label="versions">
    <img src="../_static/apache.jpg">

    <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> incubator-singa </span>
    v: 0.3.0
    <span class="fa fa-caret-down"></span>
  </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Languages</dt>
            <dd><a href="../../en/index.html">English</a></dd>
            <dd><a href="../../zh/index.html">中文</a></dd>
            <dd><a href="../../jp/index.html">日本語</a></dd>
            <dd><a href="../../kr/index.html">한국어</a></dd>
        </dl>
    </div>
</div>

<a href="https://github.com/apache/incubator-singa">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
         src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
         alt="Fork me on GitHub">
</a>

 


</body>
</html>